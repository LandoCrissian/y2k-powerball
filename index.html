<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Y2K Powerball</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;500;700&display=swap" rel="stylesheet" />

  <!-- Firebase & Config -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, increment } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCJwqDFZtf1PkZwAalOaf2_7eWtej5HIfA",
      authDomain: "y2k-arcade.firebaseapp.com",
      projectId: "y2k-arcade",
      storageBucket: "y2k-arcade.appspot.com",
      messagingSenderId: "1063043176357",
      appId: "1:1063043176357:web:20bc22e9cbf269ff40fa4c"
    };

    const app = initializeApp(firebaseConfig);
    window.db = getFirestore(app);
  </script>

  <!-- Ethers.js for CRO balance -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>

    <style>
  :root {
    --primary: #00ffe1;
    --secondary: #ff00f7;
    --background: #030014;
    --surface: #0a0a23;
    --text: #ffffff;
    --text-secondary: rgba(255, 255, 255, 0.7);
    --accent: #6e56cf;
    --success: #00ff9d;
    --warning: #ffb800;
    --error: #ff4747;
  }

  html, body {
    margin: 0;
    padding: 0;
    font-family: 'Inter', sans-serif;
    background: radial-gradient(circle at top, #0a0a23, #030014);
    color: var(--text);
    overflow-x: hidden;
  }

  .app-container {
    max-width: 100%;
    margin: 0 auto;
    padding: 20px;
    position: relative;
    z-index: 2;
  }

  .neo-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 32px;
    font-weight: 900;
    background: linear-gradient(to right, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 0 20px rgba(0, 255, 225, 0.5);
  }

  .neo-brutalism {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    padding: 24px;
    backdrop-filter: blur(20px);
    box-shadow: 0 0 40px rgba(0, 255, 225, 0.1);
  }

  .neo-button {
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 16px;
    color: var(--text);
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
  }

  .neo-button.primary {
    background: linear-gradient(45deg, var(--primary), var(--accent));
    border: none;
  }

  .neo-button.secondary {
    background: rgba(255, 255, 255, 0.05);
  }

  .neo-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
  }

  .balance-amount {
    font-size: 24px;
    font-weight: 700;
  }

  .number-picker {
    margin-top: 24px;
    text-align: center;
  }

  .number-grid {
    display: grid;
    grid-template-columns: repeat(10, 1fr);
    gap: 8px;
    margin: 12px 0 16px;
  }

  .number-grid button {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text);
    border: none;
    padding: 8px;
    border-radius: 6px;
    cursor: pointer;
    transition: 0.2s;
  }

  .number-grid button.selected {
    background: var(--primary);
    color: #000;
    font-weight: 600;
  }

  @media (max-width: 768px) {
    .neo-title { font-size: 24px; }
    .number-grid { grid-template-columns: repeat(5, 1fr); }
  }
</style>

    <body>
  <div class="noise"></div>
  <div class="app-container">

    <!-- üîå STATUS BAR -->
    <div class="status-bar">
      <div class="network-status">
        <div class="signal-dot active"></div>
        <div class="signal-dot active"></div>
        <div class="signal-dot active"></div>
        <div class="signal-dot"></div>
        <span>MAINNET</span>
      </div>
      <div class="time" id="currentTime">00:00</div>
      <div class="wallet-status" onclick="connectWallet()">
        <span class="dot pulse"></span>
        CONNECT
      </div>
    </div>

    <!-- üß† HEADER -->
    <header class="main-header">
      <div class="logo-container">
        <h1 class="neo-title">Y2K POWERBALL</h1>
        <div class="version-tag">v2.0</div>
      </div>
      <div class="user-stats">
        <div class="balance-display">
          <span class="balance-label">BALANCE</span>
          <span class="balance-amount">--</span>
          <span class="balance-currency">CRO</span>
        </div>
        <div class="badge premium">PREMIUM</div>
      </div>
    </header>

    <!-- üí∞ JACKPOT -->
    <section class="jackpot-module">
      <div class="jackpot-container neo-brutalism">
        <div class="jackpot-header">
          <span class="jackpot-label">CURRENT JACKPOT</span>
          <div class="jackpot-timer" id="drawTimer">--:--:--</div>
        </div>
        <div class="jackpot-amount">
          <span class="currency">CRO</span>
          <span class="amount" id="jackpotAmount">Loading...</span>
        </div>
        <div class="jackpot-footer">
          <div class="stat-item">
            <span class="stat-value" id="entryCount">---</span>
            <span class="stat-label">ENTRIES</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">???</span>
            <span class="stat-label">WINNERS</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">‚àû</span>
            <span class="stat-label">POTENTIAL</span>
          </div>
        </div>
      </div>

        <!-- üéüÔ∏è ENTRY MODULE -->
<section class="entry-module">
  <div class="entry-container neo-brutalism">
    <h2 class="section-title">YOUR ENTRIES</h2>
    <div class="ticket-grid" id="ticketGrid">
      <!-- Tickets will populate here -->
    </div>

    <!-- üß© NUMBER PICKER -->
    <div class="number-picker" id="numberPicker" style="display: none;">
      <h3>Pick 5 Numbers (1‚Äì69)</h3>
      <div class="number-grid" id="numberGrid"></div>
      <button class="neo-button secondary" onclick="quickPick()">Quick Pick</button>
    </div>

    <!-- üß† ACTIONS -->
    <div class="action-buttons">
      <button class="neo-button primary" id="buyButton">
        <span class="button-content">BUY ENTRY</span>
        <span class="button-price">2 CRO</span>
      </button>
      <button class="neo-button secondary" id="freeButton">
        <span class="button-content">FREE ENTRY</span>
        <span class="button-price">5 LEFT</span>
      </button>
    </div>
  </div>
</section>

        <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getFirestore,
    doc,
    getDoc,
    setDoc,
    increment,
    collection,
    query,
    orderBy,
    limit,
    getDocs
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCJwqDFZtf1PkZwAalOaf2_7eWtej5HIfA",
    authDomain: "y2k-arcade.firebaseapp.com",
    projectId: "y2k-arcade",
    storageBucket: "y2k-arcade.appspot.com",
    messagingSenderId: "1063043176357",
    appId: "1:1063043176357:web:20bc22e9cbf269ff40fa4c"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let walletAddress = null;
  let isVaultVerified = false;

  const WEEK_KEY = (() => {
    const now = new Date();
    const year = now.getFullYear();
    const week = Math.ceil((((now - new Date(year, 0, 1)) / 86400000) + new Date(year, 0, 1).getDay() + 1) / 7);
    return `${year}-W${String(week).padStart(2, '0')}`;
  })();

  async function connectWallet() {
    if (!window.ethereum) {
      alert("No wallet detected");
      return;
    }
    const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
    walletAddress = accounts[0].toLowerCase();
    document.querySelector('.wallet-status').innerHTML = `<span class="dot pulse"></span> ${walletAddress.slice(0,6)}...${walletAddress.slice(-4)}`;
    await checkVaultStatus(walletAddress);
    await updateFreeEntryUI();
    await renderTickets();
  }

  async function checkVaultStatus(wallet) {
    const ref = doc(db, "users", wallet);
    const snap = await getDoc(ref);
    isVaultVerified = snap.exists();
  }

  async function getFreeEntriesUsed(wallet) {
    const ref = doc(db, "powerball_free_entries", wallet);
    const snap = await getDoc(ref);
    return snap.exists() ? (snap.data()[WEEK_KEY] || 0) : 0;
  }

  async function incrementFreeEntry(wallet) {
    const ref = doc(db, "powerball_free_entries", wallet);
    await setDoc(ref, { [WEEK_KEY]: increment(1) }, { merge: true });
  }

  async function logTicket(wallet, method, numbers = []) {
    const ref = doc(db, "powerball_tickets", `${WEEK_KEY}_${wallet}_${Date.now()}`);
    await setDoc(ref, {
      wallet,
      method,
      numbers,
      draw: WEEK_KEY,
      timestamp: Date.now()
    });
  }

  async function handleTicket(isFree = true) {
    if (!walletAddress) await connectWallet();
    if (!walletAddress) return;

    const selected = getSelectedNumbers();
    if (selected.length !== 5) {
      alert("Pick 5 numbers first.");
      return;
    }

    if (isFree && isVaultVerified) {
      const used = await getFreeEntriesUsed(walletAddress);
      if (used >= 5) {
        alert("No free entries left.");
        return;
      }
      await incrementFreeEntry(walletAddress);
      await logTicket(walletAddress, "free", selected);
    } else {
      // TODO: integrate CRO payment here
      await logTicket(walletAddress, "paid", selected);
    }

    alert("üéüÔ∏è Entry submitted!");
    await updateFreeEntryUI();
    await renderTickets();
    clearSelected();
  }

  async function updateFreeEntryUI() {
    const btn = document.getElementById("freeButton");
    if (!btn || !walletAddress) return;
    const used = await getFreeEntriesUsed(walletAddress);
    btn.querySelector(".button-price").textContent = isVaultVerified ? `${5 - used} LEFT` : "VAULT ONLY";
  }

  function getSelectedNumbers() {
    return Array.from(document.querySelectorAll('.number-tile.selected')).map(n => parseInt(n.textContent));
  }

  function clearSelected() {
    document.querySelectorAll('.number-tile.selected').forEach(tile => tile.classList.remove('selected'));
  }

  function quickPick() {
    clearSelected();
    const numbers = [];
    while (numbers.length < 5) {
      const rand = Math.floor(Math.random() * 69) + 1;
      if (!numbers.includes(rand)) numbers.push(rand);
    }
    numbers.forEach(num => {
      const tile = document.querySelector(`.number-tile[data-num="${num}"]`);
      if (tile) tile.classList.add('selected');
    });
  }

  function renderNumberGrid() {
    const grid = document.getElementById("numberGrid");
    for (let i = 1; i <= 69; i++) {
      const tile = document.createElement("div");
      tile.className = "number-tile";
      tile.textContent = i;
      tile.dataset.num = i;
      tile.addEventListener("click", () => {
        tile.classList.toggle("selected");
        const selected = getSelectedNumbers();
        if (selected.length > 5) tile.classList.remove("selected");
      });
      grid.appendChild(tile);
    }
    document.getElementById("numberPicker").style.display = "block";
  }

  async function renderTickets() {
    const ref = collection(db, "powerball_tickets");
    const q = query(ref, orderBy("timestamp", "desc"), limit(5));
    const snap = await getDocs(q);

    const container = document.getElementById("ticketGrid");
    container.innerHTML = "";
    snap.forEach(doc => {
      const data = doc.data();
      const el = document.createElement("div");
      el.className = "ticket active";
      el.innerHTML = `
        <div class="ticket-number">${data.numbers.join(" ‚Ä¢ ")}</div>
        <div class="ticket-status">${data.method.toUpperCase()}</div>
      `;
      container.appendChild(el);
    });

    // Add "NEW ENTRY" block
    const newEntry = document.createElement("div");
    newEntry.className = "add-ticket";
    newEntry.innerHTML = `<div class="plus-icon">+</div><div class="add-label">NEW ENTRY</div>`;
    container.appendChild(newEntry);
  }

  // Add events
  document.getElementById("buyButton")?.addEventListener("click", () => handleTicket(false));
  document.getElementById("freeButton")?.addEventListener("click", () => handleTicket(true));

  // Init
  window.addEventListener("DOMContentLoaded", () => {
    connectWallet();
    renderNumberGrid();
  });
</script>

        // üü° TRACK LIVE JACKPOT (based on total paid entries)
async function updateJackpotDisplay() {
  const ref = collection(db, "powerball_tickets");
  const snap = await getDocs(ref);
  let paidCount = 0;

  snap.forEach(doc => {
    if (doc.data().method === "paid") paidCount += 1;
  });

  const croPerEntry = 2;
  const jackpotTotal = paidCount * croPerEntry;

  document.getElementById("jackpotAmount").textContent = jackpotTotal.toLocaleString();
}

// üèÜ OPTIONAL: Leaderboard (based on most entries)
async function renderLeaderboard() {
  const ref = collection(db, "powerball_tickets");
  const snap = await getDocs(ref);
  const entryCount = {};

  snap.forEach(doc => {
    const { wallet } = doc.data();
    if (!wallet) return;
    entryCount[wallet] = (entryCount[wallet] || 0) + 1;
  });

  const top = Object.entries(entryCount)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 5);

  const container = document.getElementById("winnersList");
  if (!container) return;

  container.innerHTML = "";
  top.forEach(([wallet, count]) => {
    const short = `${wallet.slice(0, 6)}...${wallet.slice(-4)}`;
    const el = document.createElement("div");
    el.className = "winner-item";
    el.innerHTML = `
      <div class="winner-info">
        <span class="winner-address">${short}</span>
        <span class="winner-time">${count} entries</span>
      </div>
      <div class="winner-amount">${(count * 2).toLocaleString()} CRO</div>
    `;
    container.appendChild(el);
  });
}

// üïí Init these on load
window.addEventListener("DOMContentLoaded", () => {
  updateJackpotDisplay();
  renderLeaderboard();
});

        
    
