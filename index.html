<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>GL1TCHBALL // Y2K ARCADE</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    :root {
      --bg: #0a0a0f;
      --surface: #16161e;
      --accent: #00ffe1;
      --accent2: #ff00f7;
      --error: #ff4444;
      --success: #00ff9d;
      --white: #fff;
      --text-faded: rgba(255,255,255,0.7);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      background: var(--bg);
      font-family: 'Orbitron', sans-serif;
      color: var(--white);
      min-height: 100vh;
    }

    .container {
      max-width: 480px;
      margin: auto;
      padding: 16px;
      padding-bottom: 100px;
    }

    header {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      margin-bottom: 24px;
    }

    .title {
      font-size: 32px;
      font-weight: 900;
      background: linear-gradient(45deg, var(--accent), var(--accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: 2px;
    }

    .subtitle {
      font-size: 12px;
      color: var(--text-faded);
      letter-spacing: 4px;
      margin-top: 4px;
    }

    .connect-block {
      margin-top: 16px;
    }

    .connect-btn {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      color: var(--white);
      padding: 12px 20px;
      border-radius: 24px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      min-height: 48px;
    }

    .connect-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--error);
      transition: background 0.3s ease;
    }

    .connect-btn.connected .connect-dot {
      background: var(--success);
    }

    .status-bar {
      margin-top: 12px;
      font-size: 13px;
      color: var(--text-faded);
      text-align: center;
    }

    .profile-section {
      background: var(--surface);
      padding: 16px;
      border-radius: 12px;
      margin-top: 24px;
      display: none;
    }

    .profile-section.active {
      display: block;
    }

    .profile-header {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .profile-img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: 2px solid var(--accent);
    }

    .profile-info {
      display: flex;
      flex-direction: column;
    }

    .nickname {
      font-size: 16px;
      font-weight: bold;
      color: var(--accent);
    }

    .handle {
      font-size: 12px;
      color: var(--text-faded);
    }

    .profile-warning {
      font-size: 13px;
      color: var(--accent2);
      margin-top: 8px;
    }

    .cta-link {
      color: var(--accent);
      font-weight: bold;
      text-decoration: underline;
      cursor: pointer;
    }

    .section {
      background: var(--surface);
      padding: 16px;
      border-radius: 12px;
      margin-top: 24px;
    }

    .section-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .collapsible {
      cursor: pointer;
    }

    .collapsible + .content {
      display: none;
    }

    .collapsible.open + .content {
      display: block;
      margin-top: 12px;
    }

    .profile-card {
  background: var(--bg-surface);
  border-radius: 16px;
  padding: 16px;
  display: none;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
}

.profile-card.active {
  display: flex;
}

.profile-inner {
  display: flex;
  align-items: center;
  gap: 14px;
  width: 100%;
}

.profile-pfp {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  border: 2px solid var(--accent-primary);
  object-fit: cover;
}

.profile-info {
  flex: 1;
}

.profile-name {
  font-size: 18px;
  color: var(--accent-primary);
  font-weight: bold;
}

.profile-handle {
  font-size: 14px;
  color: var(--text-secondary);
}

.profile-warning {
  font-size: 12px;
  color: var(--error);
  margin-top: 4px;
}

/* Number Picker */
.number-picker-section {
  background: var(--bg-surface);
  padding: 20px;
  border-radius: 16px;
  margin-bottom: 24px;
  text-align: center;
}

.picker-title {
  font-size: 18px;
  color: var(--accent-primary);
  margin-bottom: 16px;
}

.number-grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 10px;
  margin-bottom: 16px;
}

.number-grid div {
  background: rgba(255,255,255,0.05);
  color: var(--text-primary);
  padding: 12px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 16px;
  transition: all 0.2s ease;
}

.number-grid div.selected {
  background: var(--accent-primary);
  color: #000;
  font-weight: bold;
}

.enter-btn {
  padding: 12px 20px;
  border-radius: 12px;
  background: var(--gradient-glitch);
  color: #000;
  border: none;
  font-weight: bold;
  cursor: pointer;
  font-size: 16px;
}

/* Leaderboard */
.leaderboard-section {
  background: var(--bg-surface);
  border-radius: 16px;
  margin-bottom: 30px;
}

.leaderboard-header {
  padding: 16px;
  font-weight: bold;
  font-size: 16px;
  color: var(--accent-primary);
  display: flex;
  justify-content: space-between;
  cursor: pointer;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

.leaderboard-body {
  padding: 16px;
  display: block;
}

.leaderboard-section.open .leaderboard-body {
  display: none;
}

.leaderboard-list div {
  padding: 8px 0;
  border-bottom: 1px solid rgba(255,255,255,0.05);
  font-size: 14px;
  color: var(--text-secondary);
}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1 class="title">GL1TCHBALL</h1>
      <div class="subtitle">VAULT PROTOCOL</div>

      <div class="connect-block">
        <button id="connectBtn" class="connect-btn">
          <span class="connect-dot"></span>
          <span class="connect-text">CONNECT WALLET</span>
        </button>
      </div>

      <div id="statusBar" class="status-bar">Waiting for wallet...</div>
    </header>

    <!-- Profile Section -->
    <div id="profileSection" class="profile-section">
      <div class="profile-header">
        <img id="pfpImg" class="profile-img" src="https://api.dicebear.com/6.x/pixel-art/svg?seed=anon" />
        <div class="profile-info">
          <div id="nickname" class="nickname">anon</div>
          <div id="handle" class="handle">@none</div>
        </div>
      </div>
      <div id="profileWarning" class="profile-warning" style="display:none;">
        You don‚Äôt hold 4M+ Y2K. Customize your badge in the <span class="cta-link" onclick="window.open('https://y2k-the-vault.netlify.app/', '_blank')">Quantum Vault</span>.
      </div>
    </div>

    <!-- Sample Expandable Section -->
    <div class="section">
      <div class="section-title collapsible" onclick="toggleCollapse(this)">Token Pots ‚ñº</div>
      <div class="content">
        <p>Y2K: <span id="y2kPot">Loading...</span></p>
        <p>DOJO: <span id="dojoPot">Loading...</span></p>
      </div>
    </div>
  </div>

  <!-- PLAYER PROFILE CARD -->
<div id="profileSection" class="profile-card" style="display:none;">
  <div class="profile-inner">
    <img id="pfpImg" src="" alt="PFP" class="profile-pfp" />
    <div class="profile-info">
      <div id="nickname" class="profile-name">anon</div>
      <div id="handle" class="profile-handle">@none</div>
      <div id="profileWarning" class="profile-warning" style="display:none;"></div>
    </div>
  </div>
</div>

<!-- NUMBER PICKER -->
<div class="number-picker-section">
  <div class="picker-title">Pick 6 Numbers</div>
  <div class="number-grid" id="numberGrid"></div>
  <button id="enterDrawBtn" class="enter-btn">ENTER DRAW</button>
</div>

<!-- LEADERBOARD -->
<div class="leaderboard-section">
  <div class="leaderboard-header" onclick="toggleCollapse(this)">üèÜ Top Players <span class="caret">‚ñº</span></div>
  <div class="leaderboard-body">
    <div id="leaderboardList" class="leaderboard-list">Loading...</div>
  </div>
</div>

  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import {
    getFirestore, doc, getDoc
  } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCJwqDFZtf1PkZwAalOaf2_7eWtej5HIfA",
    authDomain: "y2k-arcade.firebaseapp.com",
    projectId: "y2k-arcade",
    storageBucket: "y2k-arcade.appspot.com",
    messagingSenderId: "1063043176357",
    appId: "1:1063043176357:web:20bc22e9cbf269ff40fa4c"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const connectBtn = document.getElementById("connectBtn");
  const statusBar = document.getElementById("statusBar");

  let currentWallet = "";

  connectBtn.addEventListener("click", connectWallet);

  async function connectWallet() {
    if (!window.ethereum) {
      alert("Please install MetaMask.");
      return;
    }

    const provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    const signer = provider.getSigner();
    currentWallet = (await signer.getAddress()).toLowerCase();

    const short = `${currentWallet.slice(0, 6)}...${currentWallet.slice(-4)}`;
    statusBar.textContent = `Connected: ${short}`;
    connectBtn.classList.add("connected");
    connectBtn.querySelector(".connect-text").textContent = "CONNECTED";

    const y2kBalance = await getY2KBalance(currentWallet, provider);

    if (y2kBalance >= 4000000) {
      loadVaultProfile(currentWallet);
      loadLeaderboard();
      initNumberPicker();
    } else {
      showGenericProfile();
    }
  }

  async function getY2KBalance(wallet, provider) {
    try {
      const contract = new ethers.Contract(
        "0xB4Df7d2A736Cc391146bB0dF4277E8F68247Ac6d",
        ["function balanceOf(address) view returns (uint256)"],
        provider
      );
      const raw = await contract.balanceOf(wallet);
      return parseFloat(ethers.utils.formatUnits(raw, 18));
    } catch (err) {
      console.error("Failed to fetch Y2K balance", err);
      return 0;
    }
  }

  async function loadVaultProfile(wallet) {
    try {
      const snap = await getDoc(doc(db, "users", wallet));
      if (!snap.exists()) {
        showGenericProfile(true); // eligible but not setup
        return;
      }

      const user = snap.data();
      document.getElementById("profileSection").classList.add("active");
      document.getElementById("pfpImg").src = user.pfpUrl || "https://api.dicebear.com/6.x/pixel-art/svg?seed=anon";
      document.getElementById("nickname").textContent = user.username || "anon";
      document.getElementById("handle").textContent = user.xHandle ? `@${user.xHandle}` : "@none";
      document.getElementById("profileWarning").style.display = "none";
    } catch (err) {
      console.error("Error loading Vault profile", err);
      showGenericProfile(true);
    }
  }

  function showGenericProfile(isEligible = false) {
    document.getElementById("profileSection").classList.add("active");
    document.getElementById("pfpImg").src = "https://api.dicebear.com/6.x/pixel-art/svg?seed=anon";
    document.getElementById("nickname").textContent = "anon";
    document.getElementById("handle").textContent = "@none";

    const warn = document.getElementById("profileWarning");
    warn.textContent = isEligible
      ? "Customize your profile in the Quantum Vault."
      : "You don‚Äôt hold 4M+ Y2K. Unlock profile customization in the Vault.";
    warn.style.display = "block";
  }

  // Collapsible sections
  window.toggleCollapse = (el) => {
    el.classList.toggle("open");
  }

    function initNumberPicker() {
  const grid = document.getElementById("numberGrid");
  grid.innerHTML = "";
  const selected = new Set();

  for (let i = 1; i <= 24; i++) {
    const cell = document.createElement("div");
    cell.textContent = i;
    cell.addEventListener("click", () => {
      if (selected.has(i)) {
        selected.delete(i);
        cell.classList.remove("selected");
      } else if (selected.size < 6) {
        selected.add(i);
        cell.classList.add("selected");
      }
    });
    grid.appendChild(cell);
  }

  document.getElementById("enterDrawBtn").addEventListener("click", () => {
    if (selected.size !== 6) {
      alert("Pick exactly 6 numbers!");
      return;
    }
    alert("Numbers submitted: " + [...selected].sort((a,b) => a-b).join(", "));
    // Add your backend draw entry logic here
  });
}

async function loadLeaderboard() {
  try {
    const snap = await getDocs(query(collection(db, "users"), orderBy("earnings", "desc"), limit(10)));
    const board = document.getElementById("leaderboardList");
    board.innerHTML = "";

    snap.forEach((doc, i) => {
      const u = doc.data();
      const name = u.username || "anon";
      const score = u.earnings || 0;
      board.innerHTML += `<div>#${i+1} ‚Äî @${name} | ${score} Y2K</div>`;
    });
  } catch (err) {
    document.getElementById("leaderboardList").textContent = "Error loading leaderboard.";
  }
}
    
</script>
  </body>
</html>
